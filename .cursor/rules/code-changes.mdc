---
description: Rules for making code changes safely without breaking working features
globs:
  - "**/*.ts"
  - "**/*.tsx"
  - "**/*.js"
  - "**/*.jsx"
alwaysApply: true
---

# Git Commit & Deployment Protocol

**CRITICAL: ALWAYS ask before committing or deploying.**

Rules:
- NEVER run `git commit` without explicit user approval
- NEVER deploy without explicit user approval
- ALWAYS ask: "Ready to commit these changes?"
- ALWAYS show proposed commit message and wait for approval
- ALWAYS ask: "Ready to deploy?" before any deployment

No exceptions. Every commit and deployment requires user permission.

---

# Code Removal Protocol

**Before removing ANY code, follow this checklist:**

## Pre-Removal Checklist (Mandatory)

1. ‚úÖ Read the full file first (if not already in context)
2. ‚úÖ Identify exactly what code will be removed
3. ‚úÖ Ask: "Why was this code here?"
4. ‚úÖ Check if removing it breaks anything
5. ‚úÖ Show user what will be removed + explain why
6. ‚úÖ Wait for approval if removal is non-trivial

## What Counts as "Non-Trivial Removal"?

You MUST ask for approval before removing:
- Any function or component (even if seems unused)
- Any visual features (styles, shapes, rendering logic)
- Any state management code
- Any event handlers
- Any code block over 3 lines

## Diff Preview Format (Required)

When removing code, present it like this:

```
üìã DIFF PREVIEW:

Removing:
- [Function/feature name]: [Why it's being removed]
- Lines X-Y: [What this code did]

Adding:
- [What's replacing it, or "nothing" if pure deletion]

Risk: [Potential issues from this removal]

Proceed? (yes/no)
```

---

# Tool Usage: Prefer search_replace

**For existing files:**
- ‚úÖ Use `search_replace` by default (shows exact old ‚Üí new changes)
- ‚ùå Avoid `write` unless rewriting entire file with approval

**Why:** `search_replace` makes it obvious what's changing. `write` can accidentally lose code.

**Exception:** Only use `write` on existing files if:
1. Intentionally rewriting the entire file, AND
2. User has approved it

---

# Conservative Code Change Protocol

**Default behavior: Minimal changes.**

Rules:
- If code works, leave it alone
- Never "improve" or "refactor" working code without explicit user request
- Make the smallest change that achieves the goal
- Test ALL aspects of a feature after changing it (not just what you modified)

## Before Modifying Working Code

1. ‚úÖ Verify current functionality works
2. ‚úÖ Make targeted, minimal change only
3. ‚úÖ Test ALL aspects of that feature (not just what changed)
4. ‚úÖ Confirm nothing regressed
5. ‚úÖ Compare before/after if visual feature

**Never assume improving code is desired. Only change what's explicitly requested.**

---

# Change Verification Checklist

After ANY code change:

‚ñ° Original functionality still works?
‚ñ° New functionality works?
‚ñ° No regressions introduced?
‚ñ° No unintended code removed?
‚ñ° All aspects of feature tested (not just changed part)?

---

# Anti-Patterns to Avoid

‚ùå "I'll refactor this for better code organization" ‚Üí NO (unless asked)
‚ùå Rewriting entire files when small change would work ‚Üí NO
‚ùå Removing "unused-looking" code without verification ‚Üí NO
‚ùå Committing without asking ‚Üí NO
‚ùå "Improving" working features without request ‚Üí NO

‚úÖ Make smallest possible change
‚úÖ Preserve all working functionality
‚úÖ Ask before removing anything non-trivial
‚úÖ Test comprehensively after changes
‚úÖ Get approval for commits and deploys
